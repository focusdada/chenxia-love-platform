$.fn.prevAll=function(selector){var prevEls=[];var el=this[0];if(!el){return $([])}while(el.previousElementSibling){var prev=el.previousElementSibling;if(selector){if($(prev).is(selector)){prevEls.push(prev)}}else{prevEls.push(prev)}el=prev}return $(prevEls)};$.fn.nextAll=function(selector){var nextEls=[];var el=this[0];if(!el){return $([])}while(el.nextElementSibling){var next=el.nextElementSibling;if(selector){if($(next).is(selector)){nextEls.push(next)}}else{nextEls.push(next)}el=next}return $(nextEls)};$(function(){$(".progress_bar_item_on").prevAll().css("background-color","rgba(4, 190, 2, 0.8)");$(".progress_bar_item_on_end").prevAll().css("background-color","rgba(4, 190, 2, 0.8)")});var dialog,dialog_p,dialog_title,dialog_name,dialog_tel,dialog_id,dialog_address,dialog_footer,dialog_input,dialog_birth,dialog_sex,name,tel,id,address,birth,href,reg,text,sex,i,f={dialog:function(e){$("#"+e.id).on("click",function(){$("#dialog_"+e.id+"").fadeIn(200)});this.dialog_add(e)},dialog_add:function(e){name="#"+e.id+"_name";tel="#"+e.id+"_tel";id="#"+e.id+"_id";address="#"+e.id+"_address";birth="#"+e.id+"_birth";sex="#"+e.id+"_sex";dialog_title="<div class='weui-dialog__hd'><strong class='weui-dialog__title'>"+e.title+"</strong></div>";dialog_p="<div class='weui-dialog__bd dialog_p'>"+e.p+"</div>";dialog_name="<div class='weui-cell'>"+"<div class='weui_cell__hd'><label class='weui-label'>姓名</label></div>"+"<div class='weui_cell__bd weui_cell_primary'>"+"<input id='"+e.id+"_name' class='weui-input' type='text' placeholder='请输入姓名'>"+"</div>"+"</div>";dialog_tel="<div class='weui-cell'>"+"<div class='weui_cell__hd'><label class='weui-label'>联系电话</label></div>"+"<div class='weui_cell__bd weui_cell_primary'>"+"<input id='"+e.id+"_tel' class='weui-input' type='tel' placeholder='请输入联系电话'>"+"</div>"+"</div>";dialog_id="<div class='weui-cell'>"+"<div class='weui_cell__hd'><label class='weui-label'>身份证</label></div>"+"<div class='weui_cell__bd weui_cell_primary'>"+"<input id='"+e.id+"_id' class='weui-input' type='text' placeholder='请输入身份证' value='"+$(".id").find(".weui-cell__ft").text()+"'>"+"</div>"+"</div>";dialog_address="<div class='weui-cell'>"+"<div class='weui_cell__hd'><label class='weui-label'>地址</label></div>"+"<div class='weui_cell__bd weui_cell_primary'>"+"<input id='"+e.id+"_address' class='weui-input' type='text' placeholder='请输入地址'>"+"</div>"+"</div>";dialog_birth="<div class='weui-cell'>"+"<div class='weui_cell__hd'><label class='weui-label'>生日</label></div>"+"<div id='"+e.id+"_birth' class='weui-cell__ft'>—"+"</div>"+"</div>";dialog_sex="<div class='weui-cell'>"+"<div class='weui_cell__hd'><label class='weui-label'>性别</label></div>"+"<div id='"+e.id+"_sex' class='weui-cell__ft'>—"+"</div>"+"</div>";dialog_footer="";if(e.id=="sign"){dialog_title="";dialog_footer="<div class='weui-dialog__ft'>"+"<a href='javascript:;' class='weui-dialog__btn weui-dialog__btn_default'>取消</a>"+"<a href='javascript:;' class='weui-dialog__btn weui-dialog__btn_primary'>提交</a>"+"</div>";dialog_input="<div class='weui-dialog__bd dialog_input'>"+dialog_name+dialog_tel+dialog_id+dialog_address+"</div>"}if(e.id=="clause"){dialog_input="";dialog_footer="<div class='weui-dialog__ft'>"+"<a href='javascript:;' class='weui-dialog__btn weui-dialog__btn_default'>我同意</a>"+"</div>"}if(e.id=="family"){dialog_title="";dialog_p="";dialog_address="";dialog_id="<div class='weui-cell'>"+"<div class='weui_cell__hd'><label class='weui-label'>身份证</label></div>"+"<div class='weui_cell__bd weui_cell_primary'>"+"<input id='"+e.id+"_id' class='weui-input' type='text' placeholder='请输入身份证'>"+"</div>"+"</div>";dialog_footer="<div class='weui-dialog__ft'>"+"<a href='javascript:;' class='weui-dialog__btn weui-dialog__btn_default'>取消</a>"+"<a href='javascript:;' class='weui-dialog__btn weui-dialog__btn_primary'>提交</a>"+"</div>";dialog_input="<div class='weui-dialog__bd dialog_input'>"+dialog_id+dialog_birth+dialog_name+dialog_tel+dialog_sex+"</div>"}if(e.id=="package"){dialog_input="";dialog_footer="<div class='weui-dialog__ft'>"+"<a href='javascript:;' class='weui-dialog__btn weui-dialog__btn_default'>明白了</a>"+"</div>"}dialog="<div class='js_dialog' id='dialog_"+e.id+"' style='opacity: 0; display: none;'>"+"<div class='weui-mask'></div>"+"<div class='weui-dialog'>"+dialog_title+dialog_p+dialog_input+dialog_footer+"</div>"+"</div>";$("body").append(dialog);this.id_blur(e.id);this.dialog_click(e.id)},dialog_list:function(e,l){$("."+e.id).on("click",function(){$("#dialog_"+e.id+"").fadeIn(200)});this.dialog_add(e);this.add_package(e,l)},dialog_list_click:function(e,l){$("."+e.id).on("click",function(){for(i=0;i<l.length;i++){if(l[i].id==$(this).attr("id")){$("#dialog_"+e.id).find(".weui-dialog__title").text(l[i].title);$("#dialog_"+e.id).find(".dialog_p").html(l[i].p)}}$("#dialog_"+e.id).fadeIn(200)})},dialog_click:function(e){$("#dialog_"+e+"").on("click",".weui-dialog__btn_default",function(){$(this).parents(".js_dialog").fadeOut(200)}).on("click",".weui-dialog__btn_primary",function(){if(!$(id)||f.reg_id($(id).val())){if(!$(name)||f.reg_name($(name).val())){if(!$(tel)||f.reg_tel($(tel).val())){if(!$(address)||f.reg_address($(address).val())){if(e=="sign"||e=="clause"){location.href="未签约_家庭地址_提交成功.html"
}if(e=="family"){var p={id:$(id).val(),birth:birth,name:$(name).val(),tel:$(tel).val(),sex:sex};f.add_family(p);$(id).val("");$("#"+e+"_birth").text("—");$(name).val("");$(tel).val("");$("#"+e+"_sex").text("—");$("#dialog_"+e+"").fadeOut(200)}else{}}}}}})},reg_name:function(e){if(e==""){text="姓名不能为空";this.toptips(text);return false}return true},reg_tel:function(e){if(e==""){text="联系电话不能为空";this.toptips(text);return false}reg=/^1([34578]\d{9})$/;if(!reg.test(e)){text="联系电话格式错误";this.toptips(text);return false}return true},reg_id:function(e){if(e==""){text="身份证不能为空";this.toptips(text);return false}reg=/^[1-9][0-9]{5}(19|20)[0-9]{2}((01|03|05|07|08|10|12)(0[1-9]|[1-2][0-9]|31)|(04|06|09|11)(0[1-9]|[1-2][0-9]|30)|02(0[1-9]|[1-2][0-9]))[0-9]{3}([0-9]|x|X)$/;if(!reg.test(e)){text="身份证格式错误";this.toptips(text);return false}return true},reg_address:function(e){if(e==""){text="地址不能为空";this.toptips(text);return false}return true},reg_address_select:function(e){if(e=="请选择"){text="请选择地址";this.toptips(text);return false}return true},toptips:function(e){if($(".weui-toptips").length>0){$(".weui-toptips").html(e)}else{$("body").prepend("<div class='weui-toptips weui-toptips_warn js_tooltips' style='display:none;'>"+e+"</div>")}$(".weui-toptips").show(200);setTimeout(function(){$(".weui-toptips").hide()},2000)},extract_id:function(e){birth=e.substring(6,10)+"-"+e.substring(10,12)+"-"+e.substring(12,14);if(parseInt(e.substr(16,1))%2==1){sex="男"}else{sex="女"}var myDate=new Date();var month=myDate.getMonth()+1;var day=myDate.getDate();var age=myDate.getFullYear()-e.substring(6,10)-1;if(e.substring(10,12)<month||e.substring(10,12)==month&&e.substring(12,14)<=day){age++}return{birth:birth,sex:sex,age:age}},id_blur:function(e){$("#"+e+"_id").on("blur",function(){if(f.reg_id($(this).val())){$("#"+e+"_birth").text(f.extract_id($(this).val()).birth);$("#"+e+"_sex").text(f.extract_id($(this).val()).sex)}})},add_family:function(e){var flist="<div class='weui-cells'>"+"<div class='weui-cell'>"+"<div class='weui-cell__hd'>"+"<label class='weui-label'>身份证号</label>"+"</div>"+"<div id='' class='weui-cell__ft'>"+e.id+"</div>"+"</div>"+"<div class='weui-cell'>"+"<div class='weui-cell__hd'>"+"<label class='weui-label'>生日</label>"+"</div>"+"<div id='' class='weui-cell__ft'>"+e.birth+"</div>"+"</div>"+"<div class='weui-cell'>"+"<div class='weui-cell__hd'>"+"<label class='weui-label'>姓名</label>"+"</div>"+"<div id='' class='weui-cell__ft'>"+e.name+"</div>"+"</div>"+"<div class='weui-cell'>"+"<div class='weui-cell__hd'>"+"<label class='weui-label'>联系电话</label>"+"</div>"+"<div id='' class='weui-cell__ft'>"+e.tel+"</div>"+"</div>"+"<div class='weui-cell'>"+"<div class='weui-cell__hd'>"+"<label class='weui-label'>性别</label>"+"</div>"+"<div id='' class='weui-cell__ft'>"+e.sex+"</div>"+"</div>"+"</div>";$(".flist").append(flist)},add_package:function(e,l){var plist;for(i=0;i<l.length;i++){plist="<div class='weui-form-preview'>"+"<div class='weui-form-preview__hd'>"+"<div class='weui-form-preview__item'>"+"<label class='weui-form-preview__label'>"+l[i].title+"</label>"+"<em class='weui-form-preview__value'>￥"+l[i].price+"</em>"+"</div>"+"</div>"+"<div class='weui-form-preview__bd'>"+"<div class='weui-form-preview__item'>"+"<label class='weui-form-preview__label'>有效时间</label>"+"<span class='weui-form-preview__value'>"+l[i].time+"</span>"+"</div>"+"</div>"+"<div class='weui-form-preview__ft'>"+"<a id='"+l[i].id+"' class='package weui-form-preview__btn weui-form-preview__btn_primary' href='javascript:'>查看</a>"+"</div>"+"</div>"+"<br>";$(".preview_list").append(plist)}},};(function($,window,document){var classSelector=function(name){return"."+$.className(name)};var GroupList=$.GroupList=$.Class.extend({init:function(holder,options){var self=this;self.options=options||{};self.box=holder;if(!self.box){throw"实例 GroupList 时需要指定 element"}self.createDom();self.findElements();self.caleLayout();self.bindEvent()},createDom:function(){var self=this;self.el=self.el||{};self.el.styleForSearch=document.createElement("style");(document.head||document.body).appendChild(self.el.styleForSearch)},findElements:function(){var self=this;self.el=self.el||{};self.el.search=self.box.querySelector(classSelector("group-list-search"));self.el.searchInput=self.box.querySelector(classSelector("group-list-search-input"));self.el.searchClear=self.box.querySelector(classSelector("group-list-search")+" "+classSelector("icon-clear"));self.el.bar=self.box.querySelector(classSelector("group-list-bar"));self.el.barItems=[].slice.call(self.box.querySelectorAll(classSelector("group-list-bar")+" a"));self.el.inner=self.box.querySelector(classSelector("group-list-inner"));self.el.items=[].slice.call(self.box.querySelectorAll(classSelector("group-list-item")));self.el.liArray=[].slice.call(self.box.querySelectorAll(classSelector("group-list-inner")+" li"));self.el.alert=self.box.querySelector(classSelector("group-list-alert"))},caleLayout:function(){var self=this;var withoutSearchHeight=(self.box.offsetHeight-self.el.search.offsetHeight)+"px";
    self.el.bar.style.height=withoutSearchHeight;self.el.inner.style.height=withoutSearchHeight;var barItemHeight=((self.el.bar.offsetHeight-40)/self.el.barItems.length)+"px";self.el.barItems.forEach(function(item){item.style.height=barItemHeight;item.style.lineHeight=barItemHeight})},scrollTo:function(group){var self=this;var groupElement=self.el.inner.querySelector('[data-group="'+group+'"]');if(!groupElement||(self.hiddenGroups&&self.hiddenGroups.indexOf(groupElement)>-1)){return}self.el.inner.scrollTop=groupElement.offsetTop},bindBarEvent:function(){var self=this;var pointElement=null;var findStart=function(event){if(pointElement){pointElement.classList.remove("active");pointElement=null}self.el.bar.classList.add("active");var point=event.changedTouches?event.changedTouches[0]:event;pointElement=document.elementFromPoint(point.pageX,point.pageY);if(pointElement){var group=pointElement.innerText;if(group&&group.length==1){pointElement.classList.add("active");self.el.alert.innerText=group;self.el.alert.classList.add("active");self.scrollTo(group)}}event.preventDefault()};var findEnd=function(event){self.el.alert.classList.remove("active");self.el.bar.classList.remove("active");if(pointElement){pointElement.classList.remove("active");pointElement=null}};self.el.bar.addEventListener("touchmove",function(event){findStart(event)},false);self.el.bar.addEventListener("touchstart",function(event){findStart(event)},false);document.body.addEventListener("touchend",function(event){findEnd(event)},false);document.body.addEventListener("touchcancel",function(event){findEnd(event)},false)},search:function(keyword){var self=this;keyword=(keyword||"").toLowerCase();var selectorBuffer=[];var groupIndex=-1;var itemCount=0;var liArray=self.el.liArray;var itemTotal=liArray.length;self.hiddenGroups=[];var checkGroup=function(currentIndex,last){if(itemCount>=currentIndex-groupIndex-(last?0:1)){selectorBuffer.push(classSelector("group-list-inner li")+":nth-child("+(groupIndex+1)+")");self.hiddenGroups.push(liArray[groupIndex])}groupIndex=currentIndex;itemCount=0};liArray.forEach(function(item){var currentIndex=liArray.indexOf(item);if(item.classList.contains($.className("group-list-group"))){checkGroup(currentIndex,false)}else{var text=(item.innerText||"").toLowerCase();var value=(item.getAttribute("data-value")||"").toLowerCase();var tags=(item.getAttribute("data-tags")||"").toLowerCase();if(keyword&&text.indexOf(keyword)<0&&value.indexOf(keyword)<0&&tags.indexOf(keyword)<0){selectorBuffer.push(classSelector("group-list-inner li")+":nth-child("+(currentIndex+1)+")");itemCount++}if(currentIndex>=itemTotal-1){checkGroup(currentIndex,true)}}});if(selectorBuffer.length>=itemTotal){self.el.inner.classList.add("empty")}else{if(selectorBuffer.length>0){self.el.inner.classList.remove("empty");self.el.styleForSearch.innerText=selectorBuffer.join(", ")+"{display:none;}"}else{self.el.inner.classList.remove("empty");self.el.styleForSearch.innerText=""}}},bindSearchEvent:function(){var self=this;self.el.searchInput.addEventListener("input",function(){var keyword=this.value;self.search(keyword)},false);$(self.el.search).on("tap",classSelector("icon-clear"),function(){self.search("")},false)},bindEvent:function(){var self=this;self.bindBarEvent();self.bindSearchEvent()}})})(mui,window,document);